<%- include base/header.ejs %>
<div class="main">
    <div class="login">
    	<a class="verify">验证</a>
    	<form class="login-form line-form" title="">
	        <div class="login-group line-fgroup">
				<label for="email" class="label-e"></label>
				<input type="email" name="Email" value="<%=Email%>" placeholder="邮 箱" id="email" readonly="true">

	        </div>
	        <div class="login-group line-fgroup">
				<label for="nickname" class="label-name"></label>
				<input type="text" name="nickname" value="<%=nickname%>" placeholder="昵 称" id="nickname">
	        </div>
	        <div class="login-group line-fgroup">
	        	<label for="sex" class="label-sex"></label>
				<input type="text" name="sex" value="<%=sex%>" placeholder="性 别(0为未设，1为男，2为女)" id="sex">
	        </div>
	        <div class="login-group line-fgroup">
	        	<label for="birth" class="label-br"></label>
				<input type="text" name="birth" value="<%=year+'-'+month+'-'+day%>" placeholder="生 日" id="birth">
	        </div>
	        <button id='login' type="button">保 存</button>  
        </form>  
    </div>                             
</div>
<%- include base/baseJS.ejs %>
<script type="text/javascript">
    var emailReg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
    $(document).ready(function() {


        $("a.verify").click(function() {

        	if(<%=mailChecked == 1%>) {
        		sweetAlert('已经验证过的邮箱');
        		return;
        	}
            var emailOJ = $("#email");
            if(!emailOJ.val().match(emailReg)) {
                sweetAlert("邮箱有误请从重新输入");
                return;
            }
            location.href = "/verifyEmail";
        });

        
        $("#login").click(function() {
        	var birth = $('#birth').val().split('-');
        	$.post(
                '/changeProfile',
                {
					userID: "<%=userID%>",
					sex: $('#sex').val(),
					year: birth[0],
					month: birth[1],
					day: birth[2]

				},function(data) {
					console && console.log(data);
                    //self.loading.hide();
					if (data.ret == 200 && data.data) {
						if (data.data.code == 1) {
							//修改成功
							var temp = template("template");
							self.main.html(temp);
						} else {
							sweetAlert('提示', data.data.msg, 'warning');
						}
					} else {
						sweetAlert('错误', data.msg, 'error');
					}
				},
                'json'
            );
        });
    });     
</script>
<%- include base/footer.ejs %>