<%- include base/header.ejs %>
<div class="main">
    <div class="login">
        <form class="login-form line-form" action="/users" method="post">
            <div class="login-group line-fgroup">
                <label for="email" class="label-e"></label>
                <input type="email" value="<%=result.Email%>" id="email" disabled="disabled">
            </div>
            <div class="login-group line-fgroup">
                <label for="email" class="label-name"></label>
                <input type="text" value="<%=result.nickname%>" id="name" disabled="disabled">
            </div>
            <div class="login-group line-fgroup">
                <label class="label-sex"></label>
                <div class="radiobox">
                    <label for="" class="login-r">男<input type="radio" name="sex" value="1"></label>
                    <label for="" class="login-r">女<input type="radio" name="sex" value="2"></label>
                    <label for="" class="login-r">保密<input type="radio" name="sex" value="0"></label>  
                </div>
            </div>
            <div class="login-group line-fgroup">
                <label for="br" class="label-br"></label>
                <%if(result.year && result.month && result.day){%>
                <input type="text" value="<%=result.year%>-<%=result.month%>-<%=result.day%>" id="br" placeholder="如: 1970-01-01">
                <%}else{%>
                <input type="text" value="" placeholder="如: 1970-01-01" id="br">
                <% } %>
                <input type="hidden" name="year" value="<%=result.year%>" id="year">
                <input type="hidden" name="month" value="<%=result.month%>" id="month">
                <input type="hidden" name="day" value="<%=result.day%>" id="day">
            </div>
            <button type="submit">保存</button>
        </form>
    </div>
</div>
<%- include base/baseJS.ejs %>
<script type="text/javascript">
    var users = {
        br:$("#br"),
        loginform: $(".login-form"),
        loading: $(".loading"),
        verificate: function() {
            var myreg =  /^(\d{4})-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/;
            if (!myreg.test(this.br.val())) {
                sweetAlert('格式错误', '请填写正确的日期！', 'warning');
                return false;
            }
            var lessMonth = [4,6,9,11];
            var d = new Date();
            var date = myreg.exec(this.br.val());
            var year = parseInt(date[1]);
            var month = parseInt(date[2]);
            var day = parseInt(date[3]);
            if (year<1900 || year>d.getFullYear()) {
                sweetAlert('格式错误', '请填写正确的年份！', 'warning');
                return false;
            }
            if ((lessMonth.indexOf(month) > -1) &&(day>30) ) {
                sweetAlert('格式错误', '请填写正确的日期！', 'warning');
                return false;
            }
            if (month == 2) {
                if ((year%4 == 0) && (year%100 !=0 || year%400 == 0) &&(day>29)) {
                    sweetAlert('格式错误', '请填写正确的日期！', 'warning');
                    return false;
                } else if (day>28) {
                    sweetAlert('格式错误', '请填写正确的日期！', 'warning');
                    return false;
                }
            }
            return true;
        },
        bindEvent: function() {
            var self = this;
            self.loginform.submit(function(event) {
                event.preventDefault();
                if (self.verificate()) {
                    self.loading.show();
                    global.subData('/login',{
                        email: self.email.val(),
                        password: self.pw.val()
                    },function(data){
                        console && console.log(data);
                        self.loading.hide();
                        if (data.ret == 200 && data.data) {
                            if (data.data.code == 1) {
                                window.location.href = '/'; //登录成功
                            } else {
                                sweetAlert('提示', data.data.msg, 'warning');
                            }
                        } else {
                            sweetAlert('错误', data.msg, 'error');
                        }
                    });
                }
            });
        },
        init: function() {
            this.bindEvent();
        }
    }
    users.init();
</script>
<%- include base/footer.ejs %>